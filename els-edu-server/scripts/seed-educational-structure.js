#!/usr/bin/env node\n/**\n * Seed Organizations, Courses, Subjects, and their Pricing\n * Creates a complete educational structure with discounted pricing and GST\n */\n\nconst axios = require('axios');\n\n// Configuration\nconst API_URL = process.env.STRAPI_API_URL || 'http://localhost:1337';\nconst API_TOKEN = process.env.STRAPI_API_TOKEN || '';\n\nconst headers = {\n  'Content-Type': 'application/json',\n  'Authorization': `Bearer ${API_TOKEN}`\n};\n\n// Helper function for API calls\nconst apiCall = async (method, endpoint, data = null) => {\n  try {\n    const config = {\n      method,\n      url: `${API_URL}/api/${endpoint}`,\n      headers,\n      ...(data && { data })\n    };\n    \n    const response = await axios(config);\n    return response.data;\n  } catch (error) {\n    console.error(`Error in ${method} ${endpoint}:`, error.response?.data || error.message);\n    throw error;\n  }\n};\n\n// Calculate GST (18%)\nconst calculateGST = (amount) => {\n  return Math.round((amount * 0.18) * 100) / 100;\n};\n\n// Calculate total with GST\nconst calculateTotalWithGST = (baseAmount) => {\n  const gst = calculateGST(baseAmount);\n  return baseAmount + gst;\n};\n\n// Sample data structures\nconst organizationsData = [\n  {\n    org_name: \"TechEd Solutions Private Limited\",\n    contact_email: \"contact@teched-solutions.com\",\n    contact_phone: 9876543210,\n    org_status: \"ACTIVE\",\n    description: [\n      {\n        type: \"paragraph\",\n        children: [\n          {\n            type: \"text\",\n            text: \"Leading provider of technology education solutions for K-12 and higher education. Specializes in programming, data science, and emerging technologies with hands-on learning approach.\"\n          }\n        ]\n      }\n    ]\n  },\n  {\n    org_name: \"EduCare Learning Institute\",\n    contact_email: \"info@educare-learning.org\",\n    contact_phone: 9123456789,\n    org_status: \"ACTIVE\",\n    description: [\n      {\n        type: \"paragraph\",\n        children: [\n          {\n            type: \"text\",\n            text: \"Comprehensive educational institute focusing on foundational learning, STEM education, and skill development. Committed to quality education with affordable pricing and innovative teaching methods.\"\n          }\n        ]\n      }\n    ]\n  }\n];\n\nconst coursesData = [\n  // TechEd Solutions Courses\n  {\n    name: \"Full Stack Web Development Bootcamp\",\n    category: \"Programming\",\n    subcategory: \"Web Development\",\n    description: \"Comprehensive bootcamp covering frontend and backend web development with modern frameworks and tools.\",\n    condition: \"PUBLISH\",\n    privacy: \"PUBLIC\",\n    visibility: \"GLOBAL\",\n    orgIndex: 0,\n    basePrice: 15000\n  },\n  {\n    name: \"Data Science & Machine Learning\",\n    category: \"Data Science\",\n    subcategory: \"Analytics\",\n    description: \"Complete data science program covering statistics, machine learning, and real-world project implementation.\",\n    condition: \"PUBLISH\",\n    privacy: \"PUBLIC\",\n    visibility: \"GLOBAL\",\n    orgIndex: 0,\n    basePrice: 18000\n  },\n  // EduCare Learning Courses\n  {\n    name: \"CBSE Class 10 Complete Package\",\n    category: \"Academic\",\n    subcategory: \"Secondary Education\",\n    description: \"Complete CBSE Class 10 preparation with all subjects including Math, Science, Social Studies, and Languages.\",\n    condition: \"PUBLISH\",\n    privacy: \"PUBLIC\",\n    visibility: \"GLOBAL\",\n    orgIndex: 1,\n    basePrice: 8000\n  },\n  {\n    name: \"JEE/NEET Preparation Program\",\n    category: \"Competitive Exams\",\n    subcategory: \"Engineering & Medical\",\n    description: \"Intensive preparation program for JEE Main, JEE Advanced, and NEET with expert faculty and comprehensive study material.\",\n    condition: \"PUBLISH\",\n    privacy: \"PUBLIC\",\n    visibility: \"GLOBAL\",\n    orgIndex: 1,\n    basePrice: 25000\n  }\n];\n\nconst subjectsData = [\n  // Full Stack Web Development Bootcamp Subjects\n  {\n    name: \"Frontend Development (React & JavaScript)\",\n    grade: \"GRADUATION\",\n    courseIndex: 0,\n    basePrice: 6000,\n    discountPercent: 10\n  },\n  {\n    name: \"Backend Development (Node.js & Express)\",\n    grade: \"GRADUATION\", \n    courseIndex: 0,\n    basePrice: 5500,\n    discountPercent: 15\n  },\n  {\n    name: \"Database Design & Management\",\n    grade: \"GRADUATION\",\n    courseIndex: 0,\n    basePrice: 4000,\n    discountPercent: 20\n  },\n  // Data Science & Machine Learning Subjects\n  {\n    name: \"Python for Data Science\",\n    grade: \"GRADUATION\",\n    courseIndex: 1,\n    basePrice: 7000,\n    discountPercent: 12\n  },\n  {\n    name: \"Machine Learning Algorithms\",\n    grade: \"POSTGRADUATION\",\n    courseIndex: 1,\n    basePrice: 8500,\n    discountPercent: 8\n  },\n  {\n    name: \"Data Visualization & Analytics\",\n    grade: \"GRADUATION\",\n    courseIndex: 1,\n    basePrice: 5000,\n    discountPercent: 25\n  },\n  // CBSE Class 10 Complete Package Subjects\n  {\n    name: \"Mathematics Class 10\",\n    grade: \"TENTH\",\n    courseIndex: 2,\n    basePrice: 2500,\n    discountPercent: 30\n  },\n  {\n    name: \"Science (Physics, Chemistry, Biology) Class 10\",\n    grade: \"TENTH\",\n    courseIndex: 2,\n    basePrice: 3500,\n    discountPercent: 25\n  },\n  {\n    name: \"Social Studies Class 10\",\n    grade: \"TENTH\",\n    courseIndex: 2,\n    basePrice: 2000,\n    discountPercent: 35\n  },\n  // JEE/NEET Preparation Program Subjects\n  {\n    name: \"Physics for JEE/NEET\",\n    grade: \"TWELFTH\",\n    courseIndex: 3,\n    basePrice: 9000,\n    discountPercent: 15\n  },\n  {\n    name: \"Chemistry for JEE/NEET\",\n    grade: \"TWELFTH\",\n    courseIndex: 3,\n    basePrice: 8500,\n    discountPercent: 18\n  },\n  {\n    name: \"Mathematics for JEE\",\n    grade: \"TWELFTH\",\n    courseIndex: 3,\n    basePrice: 9500,\n    discountPercent: 12\n  }\n];\n\n// Main seeding function\nasync function seedEducationalData() {\n  console.log('üå± Starting Educational Data Seeding...');\n  \n  try {\n    // Step 1: Create Organizations\n    console.log('\\nüìä Creating Organizations...');\n    const createdOrgs = [];\n    \n    for (const orgData of organizationsData) {\n      console.log(`Creating organization: ${orgData.org_name}`);\n      const org = await apiCall('POST', 'orgs', { data: orgData });\n      createdOrgs.push(org.data);\n      console.log(`‚úÖ Created organization ID: ${org.data.id}`);\n    }\n    \n    // Step 2: Create Courses\n    console.log('\\nüìö Creating Courses...');\n    const createdCourses = [];\n    \n    for (const courseData of coursesData) {\n      const { orgIndex, basePrice, ...courseAttributes } = courseData;\n      const organizationId = createdOrgs[orgIndex].id;\n      \n      const coursePayload = {\n        ...courseAttributes,\n        organization: organizationId\n      };\n      \n      console.log(`Creating course: ${courseData.name}`);\n      const course = await apiCall('POST', 'courses', { data: coursePayload });\n      createdCourses.push({ ...course.data, basePrice });\n      console.log(`‚úÖ Created course ID: ${course.data.id}`);\n    }\n    \n    // Step 3: Create Subjects\n    console.log('\\nüìñ Creating Subjects...');\n    const createdSubjects = [];\n    \n    for (const subjectData of subjectsData) {\n      const { courseIndex, basePrice, discountPercent, ...subjectAttributes } = subjectData;\n      const courseId = createdCourses[courseIndex].id;\n      \n      const subjectPayload = {\n        ...subjectAttributes,\n        courses: [courseId]\n      };\n      \n      console.log(`Creating subject: ${subjectData.name}`);\n      const subject = await apiCall('POST', 'subjects', { data: subjectPayload });\n      createdSubjects.push({ ...subject.data, basePrice, discountPercent, courseIndex });\n      console.log(`‚úÖ Created subject ID: ${subject.data.id}`);\n    }\n    \n    // Step 4: Create Course Pricing\n    console.log('\\nüí∞ Creating Course Pricing...');\n    const createdCoursePricing = [];\n    \n    for (let i = 0; i < createdCourses.length; i++) {\n      const course = createdCourses[i];\n      const courseSubjects = createdSubjects.filter(s => s.courseIndex === i);\n      \n      // Calculate total from subjects with discounts\n      const calculatedTotal = courseSubjects.reduce((total, subject) => {\n        const discountedPrice = subject.basePrice * (1 - subject.discountPercent / 100);\n        return total + discountedPrice;\n      }, 0);\n      \n      const coursePricingData = {\n        name: `${course.attributes.name} - Complete Package`,\n        course: course.id,\n        base_amount: course.basePrice,\n        currency: \"INR\",\n        pricing_type: \"COURSE_BUNDLE\",\n        auto_calculate_from_subjects: true,\n        calculated_total: calculatedTotal,\n        bundle_discount_percent: 15, // Additional bundle discount\n        gst_percent: 18,\n        gst_amount: calculateGST(calculatedTotal * 0.85), // GST on discounted amount\n        final_amount_with_gst: calculateTotalWithGST(calculatedTotal * 0.85),\n        is_active: true\n      };\n      \n      console.log(`Creating pricing for course: ${course.attributes.name}`);\n      const coursePricing = await apiCall('POST', 'course-pricings', { data: coursePricingData });\n      createdCoursePricing.push(coursePricing.data);\n      console.log(`‚úÖ Created course pricing ID: ${coursePricing.data.id}`);\n      console.log(`   Base: ‚Çπ${course.basePrice} | Calculated: ‚Çπ${calculatedTotal.toFixed(2)} | Final (with GST): ‚Çπ${coursePricingData.final_amount_with_gst.toFixed(2)}`);\n    }\n    \n    // Step 5: Create Subject Pricing\n    console.log('\\nüí≥ Creating Subject Pricing...');\n    \n    for (let i = 0; i < createdSubjects.length; i++) {\n      const subject = createdSubjects[i];\n      const coursePricing = createdCoursePricing[subject.courseIndex];\n      \n      const discountedAmount = subject.basePrice * (1 - subject.discountPercent / 100);\n      const gstAmount = calculateGST(discountedAmount);\n      const finalAmount = discountedAmount + gstAmount;\n      \n      const subjectPricingData = {\n        name: `${subject.attributes.name} - Individual`,\n        subject: subject.id,\n        course_pricing: coursePricing.id,\n        base_amount: subject.basePrice,\n        currency: \"INR\",\n        discount_percent: subject.discountPercent,\n        discounted_amount: discountedAmount,\n        gst_percent: 18,\n        gst_amount: gstAmount,\n        final_amount_with_gst: finalAmount,\n        publisher_commission_percent: 70,\n        platform_commission_percent: 30,\n        is_active: true\n      };\n      \n      console.log(`Creating pricing for subject: ${subject.attributes.name}`);\n      const subjectPricing = await apiCall('POST', 'subject-pricings', { data: subjectPricingData });\n      console.log(`‚úÖ Created subject pricing ID: ${subjectPricing.data.id}`);\n      console.log(`   Base: ‚Çπ${subject.basePrice} | Discount: ${subject.discountPercent}% | Final: ‚Çπ${finalAmount.toFixed(2)}`);\n    }\n    \n    // Step 6: Create Sample Invoices\n    console.log('\\nüßæ Creating Sample Invoices...');\n    \n    const sampleInvoices = [\n      {\n        invoice_number: \"INV-2025-EDU-001\",\n        invoice_type: \"ORG_INVOICE\",\n        invoice_status: \"PAID\",\n        org: createdOrgs[0].id,\n        course: createdCourses[0].id,\n        subtotal_amount: 13500.00,\n        gst_amount: 2430.00,\n        discount_amount: 1500.00,\n        total_amount: 14430.00,\n        currency: \"INR\",\n        due_date: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\n        notes: \"Full Stack Web Development Bootcamp - Corporate Training Package for TechEd Solutions\"\n      },\n      {\n        invoice_number: \"INV-2025-EDU-002\",\n        invoice_type: \"ORG_INVOICE\",\n        invoice_status: \"SENT\",\n        org: createdOrgs[1].id,\n        course: createdCourses[2].id,\n        subtotal_amount: 6800.00,\n        gst_amount: 1224.00,\n        discount_amount: 800.00,\n        total_amount: 7224.00,\n        currency: \"INR\",\n        due_date: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),\n        notes: \"CBSE Class 10 Complete Package - Institutional License for EduCare Learning\"\n      }\n    ];\n    \n    for (const invoiceData of sampleInvoices) {\n      console.log(`Creating invoice: ${invoiceData.invoice_number}`);\n      const invoice = await apiCall('POST', 'invoices', { data: invoiceData });\n      console.log(`‚úÖ Created invoice ID: ${invoice.data.id}`);\n    }\n    \n    console.log('\\nüéâ Educational Data Seeding Completed Successfully!');\n    console.log('\\nüìã Summary:');\n    console.log(`   Organizations: ${createdOrgs.length}`);\n    console.log(`   Courses: ${createdCourses.length}`);\n    console.log(`   Subjects: ${createdSubjects.length}`);\n    console.log(`   Course Pricings: ${createdCoursePricing.length}`);\n    console.log(`   Subject Pricings: ${createdSubjects.length}`);\n    console.log(`   Sample Invoices: ${sampleInvoices.length}`);\n    \n    console.log('\\nüîó Data Relationships:');\n    createdOrgs.forEach((org, index) => {\n      console.log(`\\nüìä ${org.attributes.org_name}:`);\n      const orgCourses = createdCourses.filter((_, courseIndex) => \n        coursesData[courseIndex].orgIndex === index\n      );\n      orgCourses.forEach((course, courseIndex) => {\n        console.log(`  üìö ${course.attributes.name}`);\n        const courseSubjects = createdSubjects.filter(s => s.courseIndex === \n          createdCourses.findIndex(c => c.id === course.id)\n        );\n        courseSubjects.forEach(subject => {\n          console.log(`    üìñ ${subject.attributes.name}`);\n        });\n      });\n    });\n    \n  } catch (error) {\n    console.error('‚ùå Error during seeding:', error.message);\n    process.exit(1);\n  }\n}\n\n// Run the seeding\nif (require.main === module) {\n  seedEducationalData()\n    .then(() => {\n      console.log('\\n‚ú® Seeding process completed successfully!');\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error('‚ùå Seeding failed:', error);\n      process.exit(1);\n    });\n}\n\nmodule.exports = { seedEducationalData };\n